<!doctype html>
<meta charset="UTF-8"> 
<html>
  <button onclick="go()">Go</button>
  <p id="test"></p>
  <script src="https://tonejs.github.io/build/Tone.min.js"></script>
  <script>
    var generator;
    var synth;

    var Module = {
      onRuntimeInitialized: function() {
        console.log('Testing');

        var theme = new Module.Theme();
        console.log("ok at aaaa");
        var test = new Module.TestRule();
        console.log("ok at aaaa");
        var p = new Module.StructuredGeneratorProducer();
        console.log("ok at aaaa");
        theme.addRule(p);
        console.log("ok at aaaa");
        theme.addRule(test);
        console.log("ok at aaaa");
        generator = theme.getGenerator();
        console.log("ok at least");

        synth = new Tone.Synth().toMaster()
        synth.triggerAttackRelease('C4', '8n')

        console.log('Ok');
      }
    };

    function go()
    {
      console.log("Go");

      document.getElementById("test").innerHTML = Tone.now();
      var stream = generator.getNext(Tone.now());

      while(stream.hasNext())
      {
        console.log(stream.getNext().getRaw());
      }

      if (true)
      {
        synth.triggerAttackRelease('G4', '8n');
      }
      else
      {
        synth.triggerAttackRelease('C4', '8n');
      }
    }

  </script>
  <script src="js/MusAI.js"></script>
</html>